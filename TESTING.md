# ğŸ§ª æµ‹è¯•æŒ‡å—

## ğŸ“– ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [åç«¯æµ‹è¯•](#-åç«¯æµ‹è¯•)
- [å‰ç«¯æµ‹è¯•](#-å‰ç«¯æµ‹è¯•)
- [æµ‹è¯•æ¶æ„](#-æµ‹è¯•æ¶æ„)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åç«¯æµ‹è¯•

```bash
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- auth.test.ts

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ¨èï¼‰
npm run test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### å‰ç«¯ E2E æµ‹è¯•

```bash
cd ui

# è¿è¡Œæ‰€æœ‰ E2E æµ‹è¯•
npm run test:e2e

# ä½¿ç”¨ UI æ¨¡å¼ï¼ˆæ¨èï¼‰
npm run test:e2e:ui

# Debug æ¨¡å¼
npm run test:e2e:debug
```

---

## ğŸ”§ åç«¯æµ‹è¯•

### æµ‹è¯•æ¶æ„ï¼ˆ6å±‚åˆ†å±‚ï¼‰

æˆ‘ä»¬é‡‡ç”¨è‡ªåº•å‘ä¸Šçš„åˆ†å±‚æµ‹è¯•ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸€å±‚éƒ½ç¨³å›ºåå†æµ‹è¯•ä¸Šå±‚ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ 6 å±‚ï¼šéƒ¨ç½²æ—¥å¿—                      â”‚  âœ… å·²å®Œæˆ
â”‚  â””â”€ deploymentLogs.test.ts            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 5 å±‚ï¼šåº”ç”¨éƒ¨ç½²                      â”‚  âœ… å·²å®Œæˆ
â”‚  â””â”€ deploy.test.ts                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 4 å±‚ï¼šç¯å¢ƒå˜é‡                      â”‚  âœ… å·²å®Œæˆ
â”‚  â””â”€ secrets.test.ts (ç¯å¢ƒå˜é‡éƒ¨åˆ†)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 3 å±‚ï¼šç§˜é’¥ç®¡ç†                      â”‚  âœ… å·²å®Œæˆ
â”‚  â””â”€ secrets.test.ts (ç§˜é’¥éƒ¨åˆ†)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 2 å±‚ï¼šç§˜é’¥ç»„                        â”‚  âœ… å·²å®Œæˆ
â”‚  â””â”€ secrets.test.ts (ç§˜é’¥ç»„éƒ¨åˆ†)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 1 å±‚ï¼šè®¤è¯æˆæƒ                      â”‚  âœ… å·²å®Œæˆ
â”‚  â””â”€ auth.test.ts                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•å¥—ä»¶

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `auth.test.ts` | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€API Key | âœ… å®Œæˆ |
| `secrets.test.ts` | ç§˜é’¥ç»„ã€ç§˜é’¥ã€ç¯å¢ƒå˜é‡ | âœ… å®Œæˆ |
| `deploy.test.ts` | åº”ç”¨ç®¡ç†ã€éƒ¨ç½² | âœ… å®Œæˆ |
| `deploymentLogs.test.ts` | éƒ¨ç½²æ—¥å¿—è®°å½• | âœ… å®Œæˆ |

### è¿è¡Œæµ‹è¯•

```bash
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šå±‚çº§
npm test -- auth.test.ts           # ç¬¬1å±‚ï¼šè®¤è¯
npm test -- secrets.test.ts        # ç¬¬2-4å±‚ï¼šç§˜é’¥ç›¸å…³
npm test -- deploy.test.ts         # ç¬¬5å±‚ï¼šéƒ¨ç½²
npm test -- deploymentLogs.test.ts # ç¬¬6å±‚ï¼šæ—¥å¿—

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ¨èï¼‰
npm run test:watch

# è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
open coverage/lcov-report/index.html
```

### æµ‹è¯•è¦†ç›–ç‡

å½“å‰æµ‹è¯•è¦†ç›–æƒ…å†µï¼š

| æ¨¡å— | è¦†ç›–ç‡ | æµ‹è¯•æ•° |
|-----|-------|--------|
| è®¤è¯æˆæƒ | âœ… ~90% | 15+ |
| ç§˜é’¥ç»„ | âœ… ~85% | 8+ |
| ç§˜é’¥ç®¡ç† | âœ… ~85% | 12+ |
| ç¯å¢ƒå˜é‡ | âœ… ~80% | 10+ |
| åº”ç”¨éƒ¨ç½² | âœ… ~85% | 10+ |
| éƒ¨ç½²æ—¥å¿— | âœ… ~80% | 8+ |

---

## ğŸ­ å‰ç«¯æµ‹è¯•

### E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰

æˆ‘ä»¬ä½¿ç”¨ Playwright è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼Œç¡®ä¿ç”¨æˆ·ç•Œé¢æ­£å¸¸å·¥ä½œã€‚

#### æµ‹è¯•å†…å®¹

| æµ‹è¯•å¥—ä»¶ | æµ‹è¯•å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `auth.spec.ts` | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€é”™è¯¯å¤„ç† | âœ… å®Œæˆ |

#### è¿è¡Œæ–¹å¼

```bash
cd ui

# 1. UI æ¨¡å¼ï¼ˆæ¨è - å¯è§†åŒ–ç•Œé¢ï¼‰
npm run test:e2e:ui

# 2. Headless æ¨¡å¼ï¼ˆå¿«é€Ÿï¼‰
npm run test:e2e

# 3. Headed æ¨¡å¼ï¼ˆæ˜¾ç¤ºæµè§ˆå™¨ï¼‰
npx playwright test --headed

# 4. Debug æ¨¡å¼ï¼ˆé€æ­¥è°ƒè¯•ï¼‰
npm run test:e2e:debug
```

#### UI æ¨¡å¼ç‰¹ç‚¹

åœ¨ UI æ¨¡å¼ä¸­ï¼Œæ‚¨å¯ä»¥ï¼š
- ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰æµ‹è¯•åˆ—è¡¨
- â–¶ï¸ å•ç‹¬è¿è¡Œä»»æ„æµ‹è¯•
- â¸ï¸ æš‚åœå’Œå•æ­¥æ‰§è¡Œ
- ğŸ“¸ æŸ¥çœ‹æ¯ä¸€æ­¥çš„æˆªå›¾å’Œ DOM
- ğŸŒ æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

#### æµ‹è¯•ç¯å¢ƒ

E2E æµ‹è¯•ä¼šè‡ªåŠ¨ï¼š
1. å¯åŠ¨åç«¯æµ‹è¯•æœåŠ¡ï¼ˆç«¯å£ 9001ï¼‰
2. å¯åŠ¨å‰ç«¯æµ‹è¯•æœåŠ¡ï¼ˆç«¯å£ 5173ï¼‰
3. ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“
4. æµ‹è¯•åè‡ªåŠ¨æ¸…ç†

#### ç‰¹åˆ«æ³¨æ„

âš ï¸ **å•ç”¨æˆ·é™åˆ¶**: ç³»ç»Ÿåªæ”¯æŒå•ç”¨æˆ·æ³¨å†Œï¼Œæµ‹è¯•ä½¿ç”¨å›ºå®šç”¨æˆ· `admin@example.com`

---

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### åç«¯æµ‹è¯•æ¶æ„

#### åˆ†å±‚æµ‹è¯•ç­–ç•¥

æˆ‘ä»¬é‡‡ç”¨è‡ªåº•å‘ä¸Šçš„æµ‹è¯•ç­–ç•¥ï¼š

1. **ç¬¬1å±‚ï¼šè®¤è¯æˆæƒ** - æœ€åŸºç¡€çš„ç”¨æˆ·å’Œæƒé™ç®¡ç†
2. **ç¬¬2å±‚ï¼šç§˜é’¥ç»„** - ç§˜é’¥çš„åˆ†ç»„ç®¡ç†ï¼ˆV2æ–°åŠŸèƒ½ï¼‰
3. **ç¬¬3å±‚ï¼šç§˜é’¥ç®¡ç†** - å®é™…çš„ç§˜é’¥å­˜å‚¨å’ŒåŠ å¯†
4. **ç¬¬4å±‚ï¼šç¯å¢ƒå˜é‡** - ç¯å¢ƒå˜é‡ç®¡ç†å’Œç§˜é’¥å¼•ç”¨
5. **ç¬¬5å±‚ï¼šåº”ç”¨éƒ¨ç½²** - åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†
6. **ç¬¬6å±‚ï¼šéƒ¨ç½²æ—¥å¿—** - éƒ¨ç½²å†å²å’Œå®¡è®¡

æ¯ä¸€å±‚éƒ½ä¾èµ–ä¸‹é¢çš„å±‚ï¼Œå› æ­¤æµ‹è¯•é¡ºåºå¾ˆé‡è¦ã€‚

#### æµ‹è¯•éš”ç¦»

- æ¯ä¸ªæµ‹è¯•éƒ½ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“ (`data/test/`)
- æµ‹è¯•å‰åè‡ªåŠ¨æ¸…ç†æ•°æ®
- å¼ºåˆ¶ WAL checkpoint ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

#### æµ‹è¯•è¾…åŠ©å·¥å…·

- `ApiClient`: å°è£… HTTP è¯·æ±‚ï¼Œè‡ªåŠ¨å¤„ç†è®¤è¯
- `createTestXxx`: ç”Ÿæˆæµ‹è¯•æ•°æ®çš„è¾…åŠ©å‡½æ•°
- Global Setup/Teardown: æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å’Œæ¸…ç†

### å‰ç«¯æµ‹è¯•æ¶æ„

#### E2E æµ‹è¯•ç­–ç•¥

- ä½¿ç”¨ Playwright è¿›è¡ŒçœŸå®æµè§ˆå™¨æµ‹è¯•
- æµ‹è¯•çœŸå®çš„ API è¯·æ±‚ï¼ˆä¸ä½¿ç”¨ Mockï¼‰
- ä½¿ç”¨ `data-testid` ç¡®ä¿é€‰æ‹©å™¨ç¨³å®š
- DOM ç­‰å¾…æœºåˆ¶å¤„ç† React å¼‚æ­¥æ¸²æŸ“

#### æµ‹è¯•ç¯å¢ƒéš”ç¦»

- ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“è·¯å¾„
- ç‹¬ç«‹çš„æµ‹è¯•ç«¯å£
- æµ‹è¯•å‰æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®
- æµ‹è¯•åæ¸…ç†æµ‹è¯•å®¹å™¨

---

## âœ… æµ‹è¯•å‰æ£€æŸ¥

è¿è¡Œæµ‹è¯•å‰è¯·ç¡®ä¿ï¼š

### Backend æµ‹è¯•

1. âœ… **Docker æ­£åœ¨è¿è¡Œ**
   ```bash
   docker ps
   ```

2. âœ… **ä¾èµ–å·²å®‰è£…**
   ```bash
   cd backend && npm install
   ```

3. âœ… **ç«¯å£æœªè¢«å ç”¨**
   - æµ‹è¯•ä½¿ç”¨ç«¯å£ 9001
   - æ£€æŸ¥ï¼š`lsof -i:9001`

### UI E2E æµ‹è¯•

1. âœ… **åç«¯å’Œå‰ç«¯ä¾èµ–å·²å®‰è£…**
   ```bash
   cd backend && npm install
   cd ../ui && npm install
   ```

2. âœ… **Playwright æµè§ˆå™¨å·²å®‰è£…**
   ```bash
   cd ui && npx playwright install
   ```

3. âœ… **ç«¯å£æœªè¢«å ç”¨**
   - åç«¯æµ‹è¯•ï¼š9001
   - å‰ç«¯æµ‹è¯•ï¼š5173

---

## ğŸ› å¸¸è§é—®é¢˜

### Backend æµ‹è¯•

#### 1. Docker æœªè¿è¡Œ

**é”™è¯¯ä¿¡æ¯**:
```
âŒ Docker daemon is not running
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# macOS
open -a Docker

# Linux
sudo systemctl start docker
```

#### 2. ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**:
```
Error: Port 9001 is already in use
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i:9001

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

#### 3. æµ‹è¯•å®¹å™¨æ®‹ç•™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†æ‰€æœ‰æµ‹è¯•å®¹å™¨
docker rm -f $(docker ps -a --filter "name=test-" -q)
```

#### 4. æ•°æ®åº“é”å®š

**é”™è¯¯ä¿¡æ¯**:
```
Error: database is locked
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åˆ é™¤æµ‹è¯•æ•°æ®åº“
cd backend
rm -rf data/test/*
```

### UI E2E æµ‹è¯•

#### 1. æœåŠ¡å¯åŠ¨è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**:
```
TimeoutError: Timeout 120000ms exceeded
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ‰‹åŠ¨å¯åŠ¨æœåŠ¡æ£€æŸ¥æ˜¯å¦æ­£å¸¸
cd backend && npm run test:serve  # ç«¯å£ 9001
cd ui && npm run test:serve       # ç«¯å£ 5173
```

#### 2. æ‰¾ä¸åˆ°å…ƒç´ 

**é”™è¯¯ä¿¡æ¯**:
```
TimeoutError: waiting for locator('[data-testid="xxx"]')
```

**å¯èƒ½åŸå› **:
- React æ¸²æŸ“æœªå®Œæˆ
- data-testid åç§°é”™è¯¯
- é¡µé¢è·³è½¬æœªå®Œæˆ

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ UI æ¨¡å¼æŸ¥çœ‹å®é™…é¡µé¢çŠ¶æ€

#### 3. æµ‹è¯•æ•°æ®å†²çª

**é—®é¢˜**: ç”¨æˆ·å·²å­˜åœ¨å¯¼è‡´æ³¨å†Œå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**: 
- æµ‹è¯•ä¼šè‡ªåŠ¨æ¸…ç†æ•°æ®åº“
- å¦‚æœå¤±è´¥ï¼Œæ‰‹åŠ¨åˆ é™¤: `rm -rf backend/data/test/*`

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘æ—¶

1. **ä½¿ç”¨ç›‘å¬æ¨¡å¼**
   ```bash
   npm run test:watch  # åç«¯
   npm run test:e2e:ui # å‰ç«¯ï¼ˆUIæ¨¡å¼ï¼‰
   ```

2. **å•ç‹¬æµ‹è¯•ä¿®æ”¹çš„æ¨¡å—**
   ```bash
   npm test -- auth.test.ts
   ```

3. **æŸ¥çœ‹è¦†ç›–ç‡ç¡®ä¿æ–°ä»£ç æœ‰æµ‹è¯•**
   ```bash
   npm run test:coverage
   ```

### æäº¤å‰

1. **è¿è¡Œæ‰€æœ‰æµ‹è¯•**
   ```bash
   cd backend && npm test
   cd ../ui && npm run test:e2e
   ```

2. **æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡**
   ```bash
   cd backend && npm run test:coverage
   ```

3. **æ¸…ç†æµ‹è¯•èµ„æº**
   ```bash
   docker rm -f $(docker ps -a --filter "name=test-" -q)
   ```

### CI/CD

1. **ä½¿ç”¨ headless æ¨¡å¼**
   ```bash
   npm test                # åç«¯
   npm run test:e2e        # å‰ç«¯
   ```

2. **ä¿å­˜æµ‹è¯•æŠ¥å‘Š**
   - åç«¯: `backend/coverage/`
   - å‰ç«¯: `ui/playwright-report/`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [åç«¯æµ‹è¯•æŒ‡å—](./backend/TESTING_GUIDE.md) | è¯¦ç»†çš„åç«¯æµ‹è¯•è¯´æ˜ |
| [åç«¯å¿«é€Ÿå¼€å§‹](./backend/TESTING_QUICKSTART.md) | 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ |
| [æµ‹è¯•ä»£ç ç»“æ„](./backend/tests/README.md) | æµ‹è¯•ä»£ç ç»„ç»‡ |
| [UIæµ‹è¯•æ ‡è¯†æŒ‡å—](./ui/DATA_TESTID_GUIDE.md) | data-testid ä½¿ç”¨è§„èŒƒ |

---

## ğŸ“Š æµ‹è¯•çŠ¶æ€

### åç«¯æµ‹è¯•

| æµ‹è¯•å¥—ä»¶ | çŠ¶æ€ | æµ‹è¯•æ•° |
|---------|------|--------|
| è®¤è¯æˆæƒ | âœ… é€šè¿‡ | 15+ |
| ç§˜é’¥ç»„ | âœ… é€šè¿‡ | 8+ |
| ç§˜é’¥ç®¡ç† | âœ… é€šè¿‡ | 12+ |
| ç¯å¢ƒå˜é‡ | âœ… é€šè¿‡ | 10+ |
| åº”ç”¨éƒ¨ç½² | âœ… é€šè¿‡ | 10+ |
| éƒ¨ç½²æ—¥å¿— | âœ… é€šè¿‡ | 8+ |

### å‰ç«¯ E2E æµ‹è¯•

| æµ‹è¯•å¥—ä»¶ | çŠ¶æ€ | æµ‹è¯•æ•° |
|---------|------|--------|
| è®¤è¯æµç¨‹ | âœ… é€šè¿‡ | 3 |

---

**æœ€åæ›´æ–°**: 2025-10-24  
**çŠ¶æ€**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

ç¥æµ‹è¯•æ„‰å¿«ï¼ğŸ‰
